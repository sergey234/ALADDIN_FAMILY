name: iOS Simple Test 8 - Verify .app File

on:
  push:
    branches: [ main ]
    paths: [ 'mobile_apps/ALADDIN_iOS/simple_test_8.txt' ]

jobs:
  verify-app-test:
    runs-on: macos-latest
    timeout-minutes: 10
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.0.0'
        
    - name: Test 8 - Verify .app File
      run: |
        echo "üß™ –¢–ï–°–¢ 8: –ü–†–û–í–ï–†–ö–ê .app –§–ê–ô–õ–ê"
        echo "================================"
        
        cd mobile_apps/ALADDIN_iOS
        
        echo "–°–Ω–∞—á–∞–ª–∞ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:"
        
        # –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–±–æ—Ä–∫–∏
        rm -rf build/
        
        # –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º
        if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -configuration Release -destination "platform=iOS Simulator,name=iPhone 15" build; then
          echo "‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞"
          
          echo ""
          echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º .app —Ñ–∞–π–ª:"
          
          # –ò—â–µ–º .app —Ñ–∞–π–ª—ã
          APP_FILES=$(find build/ -name "*.app" -type d)
          
          if [ -n "$APP_FILES" ]; then
            echo "‚úÖ .app —Ñ–∞–π–ª—ã –Ω–∞–π–¥–µ–Ω—ã:"
            echo "$APP_FILES"
            
            # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π .app —Ñ–∞–π–ª
            APP_FILE=$(echo "$APP_FILES" | head -1)
            
            echo ""
            echo "üì± –ê–ù–ê–õ–ò–ó .app –§–ê–ô–õ–ê:"
            echo "–ü—É—Ç—å: $APP_FILE"
            echo "–†–∞–∑–º–µ—Ä: $(du -sh "$APP_FILE" | cut -f1)"
            
            echo ""
            echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ .app —Ñ–∞–π–ª–∞:"
            ls -la "$APP_FILE"
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º Info.plist
            if [ -f "$APP_FILE/Info.plist" ]; then
              echo ""
              echo "üìÑ Info.plist –Ω–∞–π–¥–µ–Ω:"
              plutil -p "$APP_FILE/Info.plist" | head -15
            else
              echo ""
              echo "‚ùå Info.plist –Ω–µ –Ω–∞–π–¥–µ–Ω"
            fi
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª
            EXECUTABLE=$(find "$APP_FILE" -name "ALADDIN" -type f | head -1)
            if [ -n "$EXECUTABLE" ]; then
              echo ""
              echo "‚úÖ –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω: $EXECUTABLE"
              echo "–†–∞–∑–º–µ—Ä –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞: $(du -sh "$EXECUTABLE" | cut -f1)"
            else
              echo ""
              echo "‚ùå –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
            fi
            
            echo ""
            echo "üéâ –£–°–ü–ï–•! .app –§–ê–ô–õ –ì–û–¢–û–í –î–õ–Ø APP STORE!"
            
          else
            echo "‚ùå .app —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
            echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ build –ø–∞–ø–∫–∏:"
            find build/ -type f | head -10
          fi
          
        else
          echo "‚ùå –ö–æ–º–ø–∏–ª—è—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å"
        fi
        
        echo "‚úÖ –¢–µ—Å—Ç 8 –∑–∞–≤–µ—Ä—à–µ–Ω"
        
    - name: Upload Test 8 Results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: ios-simple-test-8
        path: mobile_apps/ALADDIN_iOS/build/
        retention-days: 1
