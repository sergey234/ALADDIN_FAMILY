name: iOS Error 70 - Quick Fix

on:
  push:
    branches: [ main ]
    paths: [ 'mobile_apps/ALADDIN_iOS/trigger_error70_fix.txt' ]

jobs:
  fix-error70:
    runs-on: macos-latest
    timeout-minutes: 10
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.0.0'
        
    - name: Quick Fix - Error 70
      run: |
        cd mobile_apps/ALADDIN_iOS
        echo "üö® –ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–ö–ò 70"
        echo "–ü–†–û–ë–õ–ï–ú–ê: platform=iOS –∏—â–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"
        echo "–†–ï–®–ï–ù–ò–ï: platform=iOS Simulator –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏–º—É–ª—è—Ç–æ—Ä"
        
        # –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–±–æ—Ä–∫–∏
        rm -rf build/
        
        echo "=== –°–ü–ò–°–û–ö –î–û–°–¢–£–ü–ù–´–• –°–ò–ú–£–õ–Ø–¢–û–†–û–í ==="
        xcrun simctl list devices available | grep "iPhone" | head -5
        
        echo "=== –ö–û–ú–ü–ò–õ–Ø–¶–ò–Ø –ù–ê –°–ò–ú–£–õ–Ø–¢–û–†–ï ==="
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏–º—É–ª—è—Ç–æ—Ä iPhone 15 (–≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ GitHub Actions)
        xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -destination "platform=iOS Simulator,name=iPhone 15" build
        
        echo "=== –ü–†–û–í–ï–†–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–ê ==="
        echo "Build –ø–∞–ø–∫–∞:"
        ls -la build/
        
        echo "–ò—â–µ–º .app —Ñ–∞–π–ª—ã:"
        find build/ -name "*.app" -type d -exec echo "‚úÖ –ù–∞–π–¥–µ–Ω: {}" \;
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä .app —Ñ–∞–π–ª–∞
        APP_FILE=$(find build/ -name "*.app" -type d | head -1)
        if [ -n "$APP_FILE" ]; then
          echo "üì± –†–∞–∑–º–µ—Ä .app —Ñ–∞–π–ª–∞:"
          du -sh "$APP_FILE"
          echo "üìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ .app —Ñ–∞–π–ª–∞:"
          ls -la "$APP_FILE"
        fi
        
    - name: Upload Fixed Build
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: ios-error70-fixed
        path: mobile_apps/ALADDIN_iOS/build/
        retention-days: 7
