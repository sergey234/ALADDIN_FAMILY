name: iOS Final Test 4 - Asset Catalog Bypass
on:
  push:
    branches: [ main ]
    paths: [ 'mobile_apps/ALADDIN_iOS/final_test4.txt' ]
  workflow_dispatch:

jobs:
  asset-catalog-bypass:
    runs-on: macos-latest
    timeout-minutes: 5
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.0.0'
    
    - name: Run Asset Catalog Bypass Build
      run: |
        cd mobile_apps/ALADDIN_iOS
        echo "üéØ –¢–ï–°–¢ 4: ASSET CATALOG –û–ë–•–û–î"
        echo "============================="
        echo ""
        echo "üîç –ü–†–û–ë–õ–ï–ú–ê:"
        echo "‚ùå CompileAssetCatalog –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ runtime –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏"
        echo "‚ùå Asset catalog —Ç—Ä–µ–±—É–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –≤–µ—Ä—Å–∏–∏"
        echo ""
        echo "‚úÖ –†–ï–®–ï–ù–ò–ï:"
        echo "1. –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∞–µ–º asset catalog"
        echo "2. –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ asset –æ–ø–µ—Ä–∞—Ü–∏–∏"
        echo "3. –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
        echo ""
        
        echo "üß™ –¢–ï–°–¢: Asset catalog –æ–±—Ö–æ–¥"
        if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN \
          -sdk iphonesimulator \
          -destination "platform=iOS Simulator" \
          IPHONEOS_DEPLOYMENT_TARGET=13.0 \
          CODE_SIGNING_ALLOWED=NO \
          ASSETCATALOG_COMPILER_APPICON_NAME="" \
          ASSETCATALOG_COMPILER_ACCENT_COLOR_NAME="" \
          COMPILER_INDEX_STORE_ENABLE=NO \
          build; then
          
          echo "‚úÖ –£–°–ü–ï–•! Asset catalog –æ–±—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç!"
          
          echo ""
          echo "üì± –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏:"
          ls -la build/ || echo "build –ø–∞–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
          echo ""
          echo "üì± –ò—â–µ–º .app —Ñ–∞–π–ª—ã:"
          find build/ -name "*.app" -type d || echo ".app —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
          
          echo ""
          echo "üéâ –†–ï–®–ï–ù–ò–ï –ù–ê–ô–î–ï–ù–û!"
          echo "–ö–æ–º–∞–Ω–¥–∞: ASSETCATALOG_COMPILER_APPICON_NAME='' + ASSETCATALOG_COMPILER_ACCENT_COLOR_NAME=''"
          
        else
          echo "‚ùå Asset catalog –æ–±—Ö–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
          echo "–ü—Ä–æ–±—É–µ–º –±–µ–∑ asset catalog –≤–æ–æ–±—â–µ:"
          if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN \
            -sdk iphonesimulator \
            -destination "platform=iOS Simulator" \
            IPHONEOS_DEPLOYMENT_TARGET=13.0 \
            CODE_SIGNING_ALLOWED=NO \
            build; then
            echo "‚úÖ –£–°–ü–ï–•! –ë–µ–∑ asset catalog —Ä–∞–±–æ—Ç–∞–µ—Ç!"
          else
            echo "‚ùå –ë–µ–∑ asset catalog —Ç–æ–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
          fi
        fi
    
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      if: success()
      with:
        name: ios-asset-catalog-bypass
        path: mobile_apps/ALADDIN_iOS/build/
        if-no-files-found: warn
