name: iOS Test 10 - .app Verification

on:
  push:
    branches: [ main ]
    paths: [ 'mobile_apps/ALADDIN_iOS/trigger_test10.txt' ]

jobs:
  test-10-verification:
    runs-on: macos-latest
    timeout-minutes: 15
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.0.0'
        
    - name: Test 10 - Verify .app Creation
      run: |
        cd mobile_apps/ALADDIN_iOS
        echo "=== –¢–ï–°–¢ 10: –ü–†–û–í–ï–†–ö–ê –°–û–ó–î–ê–ù–ò–Ø .app –§–ê–ô–õ–ê ==="
        
        # –°–Ω–∞—á–∞–ª–∞ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º
        rm -rf build/
        xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -configuration Release -destination "platform=iOS Simulator,name=iPhone 15" build
        
        echo ""
        echo "–ò—â–µ–º .app —Ñ–∞–π–ª—ã –≤ build –ø–∞–ø–∫–µ:"
        find build/ -name "*.app" -type d -exec echo "‚úÖ –ù–∞–π–¥–µ–Ω: {}" \;
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ .app —Ñ–∞–π–ª–∞
        APP_FILE=$(find build/ -name "*.app" -type d | head -1)
        if [ -n "$APP_FILE" ]; then
          echo ""
          echo "üì± –ê–ù–ê–õ–ò–ó .app –§–ê–ô–õ–ê:"
          echo "–ü—É—Ç—å: $APP_FILE"
          echo "–†–∞–∑–º–µ—Ä: $(du -sh "$APP_FILE" | cut -f1)"
          echo ""
          echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ .app —Ñ–∞–π–ª–∞:"
          ls -la "$APP_FILE"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º Info.plist
          if [ -f "$APP_FILE/Info.plist" ]; then
            echo ""
            echo "üìÑ Info.plist –Ω–∞–π–¥–µ–Ω:"
            plutil -p "$APP_FILE/Info.plist" | head -15
          else
            echo ""
            echo "‚ùå Info.plist –Ω–µ –Ω–∞–π–¥–µ–Ω"
          fi
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª
          EXECUTABLE=$(find "$APP_FILE" -name "ALADDIN" -type f | head -1)
          if [ -n "$EXECUTABLE" ]; then
            echo ""
            echo "‚úÖ –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω: $EXECUTABLE"
            echo "–†–∞–∑–º–µ—Ä –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞: $(du -sh "$EXECUTABLE" | cut -f1)"
          else
            echo ""
            echo "‚ùå –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
          fi
          
          echo ""
          echo "üéâ –£–°–ü–ï–•! .app –§–ê–ô–õ –ì–û–¢–û–í –î–õ–Ø APP STORE!"
        else
          echo ""
          echo "‚ùå –û–®–ò–ë–ö–ê: .app –§–ê–ô–õ –ù–ï –ù–ê–ô–î–ï–ù"
          echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏"
        fi
        
    - name: Upload Test 10 Results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: ios-test10-verification
        path: mobile_apps/ALADDIN_iOS/build/
        retention-days: 7
