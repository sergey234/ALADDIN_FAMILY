name: iOS Test - Error 70 Fix

on:
  push:
    branches: [ main ]
    paths: [ 'mobile_apps/ALADDIN_iOS/test.txt' ]

jobs:
  ios-test:
    runs-on: macos-latest
    timeout-minutes: 5
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.0.0'
        
    - name: iOS Test
      run: |
        echo "üéØ iOS –¢–ï–°–¢ - –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï ERROR 70"
        echo "=================================="
        
        cd mobile_apps/ALADDIN_iOS
        
        echo ""
        echo "üîç –ü–†–û–ë–õ–ï–ú–ê:"
        echo "‚ùå Error 70: Unable to find a device matching the provided destination specifier"
        echo "‚ùå { platform:iOS } - –∏—â–µ—Ç –†–ï–ê–õ–¨–ù–û–ï —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"
        
        echo ""
        echo "‚úÖ –†–ï–®–ï–ù–ò–ï:"
        echo "–ò—Å–ø–æ–ª—å–∑—É–µ–º iPhone 16 Pro —Å iOS 18.0 (—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –≤–µ—Ä—Å–∏–∏)"
        
        echo ""
        echo "üß™ –¢–ï–°–¢: Generic destination"
        if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -destination "platform=iOS Simulator,name=iPhone 16 Pro,OS=18.0" build; then
          echo "‚úÖ –£–°–ü–ï–•! Generic destination —Ä–∞–±–æ—Ç–∞–µ—Ç!"
          
          echo ""
          echo "üì± –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏:"
          ls -la build/
          echo ""
          echo "üì± –ò—â–µ–º .app —Ñ–∞–π–ª—ã:"
          find build/ -name "*.app" -type d
          
          echo ""
          echo "üéâ –†–ï–®–ï–ù–ò–ï –ù–ê–ô–î–ï–ù–û!"
          echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: -destination 'platform=iOS Simulator,name=iPhone 16'"
        else
          echo "‚ùå Generic destination –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
          echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–∏–º—É–ª—è—Ç–æ—Ä—ã:"
          xcrun simctl list devices available | grep iPhone | head -3
        fi
        
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: ios-test-artifacts
        path: mobile_apps/ALADDIN_iOS/build/
        retention-days: 7
