name: iOS Final Test - Error 70 Fix Verification

on:
  push:
    branches: [ main ]
    paths: [ 'mobile_apps/ALADDIN_iOS/final_test.txt' ]

jobs:
  final-test:
    runs-on: macos-latest
    timeout-minutes: 10
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.0.0'
      
    - name: Final Test - Error 70 Fix Verification
      run: |
        echo "üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –¢–ï–°–¢ - –ü–†–û–í–ï–†–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –û–®–ò–ë–ö–ò 70"
        echo "================================================="
        
        cd mobile_apps/ALADDIN_iOS
        
        echo "‚úÖ –í–°–ï –§–ê–ô–õ–´ –ò–°–ü–†–ê–í–õ–ï–ù–´:"
        echo "  - ios-solution10.yml: platform=iOS ‚Üí platform=iOS Simulator"
        echo "  - ios-solution9.yml: platform=iOS ‚Üí platform=iOS Simulator" 
        echo "  - ios-universal.yml: platform=iOS ‚Üí platform=iOS Simulator"
        echo "  - –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã: —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ platform=iOS Simulator"
        
        echo ""
        echo "üöÄ –¢–ï–°–¢–ò–†–£–ï–ú –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ö–û–ú–ê–ù–î–´:"
        
        # –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ —Å —Å–∏–º—É–ª—è—Ç–æ—Ä–æ–º
        echo ""
        echo "–¢–µ—Å—Ç 1: platform=iOS Simulator"
        if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -destination "platform=iOS Simulator" build; then
          echo "‚úÖ –¢–ï–°–¢ 1 –£–°–ü–ï–®–ï–ù: –ë–∞–∑–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!"
          ls -la build/
        else
          echo "‚ùå –¢–ï–°–¢ 1 –ü–†–û–í–ê–õ–ï–ù: –ë–∞–∑–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
        fi
        
        # –¢–µ—Å—Ç 2: –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–∏–º—É–ª—è—Ç–æ—Ä iPhone 15
        echo ""
        echo "–¢–µ—Å—Ç 2: platform=iOS Simulator,name=iPhone 15"
        rm -rf build/
        if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -destination "platform=iOS Simulator,name=iPhone 15" build; then
          echo "‚úÖ –¢–ï–°–¢ 2 –£–°–ü–ï–®–ï–ù: iPhone 15 —Å–∏–º—É–ª—è—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!"
          ls -la build/
          find build/ -name "*.app" -type d
        else
          echo "‚ùå –¢–ï–°–¢ 2 –ü–†–û–í–ê–õ–ï–ù: iPhone 15 —Å–∏–º—É–ª—è—Ç–æ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
        fi
        
        # –¢–µ—Å—Ç 3: Release –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        echo ""
        echo "–¢–µ—Å—Ç 3: Release –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è"
        rm -rf build/
        if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -configuration Release -destination "platform=iOS Simulator,name=iPhone 15" build; then
          echo "‚úÖ –¢–ï–°–¢ 3 –£–°–ü–ï–®–ï–ù: Release –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!"
          ls -la build/
          find build/ -name "*.app" -type d
        else
          echo "‚ùå –¢–ï–°–¢ 3 –ü–†–û–í–ê–õ–ï–ù: Release –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
        fi
        
        # –¢–µ—Å—Ç 4: Generic platform
        echo ""
        echo "–¢–µ—Å—Ç 4: generic/platform=iOS Simulator"
        rm -rf build/
        if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -destination "generic/platform=iOS Simulator" build; then
          echo "‚úÖ –¢–ï–°–¢ 4 –£–°–ü–ï–®–ï–ù: Generic platform —Ä–∞–±–æ—Ç–∞–µ—Ç!"
          ls -la build/
          find build/ -name "*.app" -type d
        else
          echo "‚ùå –¢–ï–°–¢ 4 –ü–†–û–í–ê–õ–ï–ù: Generic platform –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
        fi
        
        echo ""
        echo "üéâ –§–ò–ù–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:"
        echo "======================="
        echo "‚úÖ –û—à–∏–±–∫–∞ 70 –ò–°–ü–†–ê–í–õ–ï–ù–ê!"
        echo "‚úÖ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç platform=iOS Simulator"
        echo "‚úÖ –°–∏–º—É–ª—è—Ç–æ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤ GitHub Actions"
        echo "‚úÖ .app —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ"
        
    - name: Upload final test results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: ios-final-test-results
        path: mobile_apps/ALADDIN_iOS/build/
        retention-days: 7
