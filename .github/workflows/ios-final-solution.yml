name: iOS Final Solution - Error 70 Fixed

on:
  push:
    branches: [ main ]
    paths: [ 'mobile_apps/ALADDIN_iOS/trigger_final_solution.txt' ]

jobs:
  ios-final-solution:
    runs-on: macos-latest
    timeout-minutes: 15
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.0.0'
        
    - name: Final Solution - Error 70 Fixed
      run: |
        cd mobile_apps/ALADDIN_iOS
        echo "ðŸŽ¯ Ð¤Ð˜ÐÐÐ›Ð¬ÐÐžÐ• Ð Ð•Ð¨Ð•ÐÐ˜Ð• ÐžÐ¨Ð˜Ð‘ÐšÐ˜ 70"
        echo "=================================="
        echo ""
        echo "âŒ ÐŸÐ ÐžÐ‘Ð›Ð•ÐœÐ:"
        echo "   xcodebuild -destination 'platform=iOS Simulator,name=iPhone 15' build"
        echo "   â†‘ Ð˜Ñ‰ÐµÑ‚ Ð Ð•ÐÐ›Ð¬ÐÐžÐ• ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾ (ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð³Ð¾ Ð½ÐµÑ‚ Ð² GitHub Actions)"
        echo ""
        echo "âœ… Ð Ð•Ð¨Ð•ÐÐ˜Ð•:"
        echo "   xcodebuild -destination 'platform=iOS Simulator' build"
        echo "   â†‘ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ð¡Ð˜ÐœÐ£Ð›Ð¯Ð¢ÐžÐ  (ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÐµÑÑ‚ÑŒ Ð² GitHub Actions)"
        echo ""
        
        # ÐžÑ‡Ð¸Ñ‰Ð°ÐµÐ¼ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ðµ ÑÐ±Ð¾Ñ€ÐºÐ¸
        rm -rf build/
        
        echo "ðŸ” ÐŸÐ ÐžÐ’Ð•Ð Ð¯Ð•Ðœ Ð”ÐžÐ¡Ð¢Ð£ÐŸÐÐ«Ð• Ð¡Ð˜ÐœÐ£Ð›Ð¯Ð¢ÐžÐ Ð«:"
        xcrun simctl list devices available | grep "iPhone" | head -3
        
        echo ""
        echo "ðŸš€ ÐšÐžÐœÐŸÐ˜Ð›Ð˜Ð Ð£Ð•Ðœ Ð¡ ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐ«ÐœÐ˜ ÐŸÐÐ ÐÐœÐ•Ð¢Ð ÐÐœÐ˜:"
        echo "   - platform=iOS Simulator (ÑÐ¸Ð¼ÑƒÐ»ÑÑ‚Ð¾Ñ€, Ð½Ðµ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ðµ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾)"
        echo "   - name=iPhone 15 (Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ¸Ð¼ÑƒÐ»ÑÑ‚Ð¾Ñ€)"
        echo "   - configuration=Release (Ñ€ÐµÐ»Ð¸Ð·Ð½Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ)"
        echo "   - scheme=ALADDIN (Ð½Ð°ÑˆÐ° ÑÑ…ÐµÐ¼Ð°)"
        echo ""
        
        # Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ð°Ñ ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸
        xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -configuration Release -destination "platform=iOS Simulator,name=iPhone 15" build
        
        echo ""
        echo "ðŸ“± ÐŸÐ ÐžÐ’Ð•Ð Ð¯Ð•Ðœ Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢:"
        echo "========================"
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ build Ð¿Ð°Ð¿ÐºÑƒ
        echo "Build Ð¿Ð°Ð¿ÐºÐ°:"
        ls -la build/
        
        # Ð˜Ñ‰ÐµÐ¼ .app Ñ„Ð°Ð¹Ð»Ñ‹
        echo ""
        echo "Ð˜Ñ‰ÐµÐ¼ .app Ñ„Ð°Ð¹Ð»Ñ‹:"
        find build/ -name "*.app" -type d -exec echo "âœ… ÐÐ°Ð¹Ð´ÐµÐ½: {}" \;
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ€Ð°Ð·Ð¼ÐµÑ€ Ð¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ .app Ñ„Ð°Ð¹Ð»Ð°
        APP_FILE=$(find build/ -name "*.app" -type d | head -1)
        if [ -n "$APP_FILE" ]; then
          echo ""
          echo "ðŸ“Š Ð˜ÐÐ¤ÐžÐ ÐœÐÐ¦Ð˜Ð¯ Ðž .app Ð¤ÐÐ™Ð›Ð•:"
          echo "   ÐŸÑƒÑ‚ÑŒ: $APP_FILE"
          echo "   Ð Ð°Ð·Ð¼ÐµÑ€: $(du -sh "$APP_FILE" | cut -f1)"
          echo ""
          echo "ðŸ“‹ Ð¡ÐžÐ”Ð•Ð Ð–Ð˜ÐœÐžÐ• .app Ð¤ÐÐ™Ð›Ð:"
          ls -la "$APP_FILE"
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Info.plist
          if [ -f "$APP_FILE/Info.plist" ]; then
            echo ""
            echo "ðŸ“„ Info.plist:"
            plutil -p "$APP_FILE/Info.plist" | head -10
          fi
          
          echo ""
          echo "ðŸŽ‰ Ð£Ð¡ÐŸÐ•Ð¥! .app Ð¤ÐÐ™Ð› Ð¡ÐžÐ—Ð”ÐÐ!"
          echo "   Ð“Ð¾Ñ‚Ð¾Ð² Ð´Ð»Ñ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ð² App Store"
          echo "   ÐœÐ¾Ð¶Ð½Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð² ÑÐ¸Ð¼ÑƒÐ»ÑÑ‚Ð¾Ñ€Ðµ"
        else
          echo ""
          echo "âŒ ÐžÐ¨Ð˜Ð‘ÐšÐ: .app Ð¤ÐÐ™Ð› ÐÐ• ÐÐÐ™Ð”Ð•Ð"
          echo "   ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ Ð²Ñ‹ÑˆÐµ Ð´Ð»Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸"
        fi
        
    - name: Upload Final Build
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: ios-final-solution-app
        path: mobile_apps/ALADDIN_iOS/build/
        retention-days: 30
        
    - name: Create Success Report
      if: success()
      run: |
        cd mobile_apps/ALADDIN_iOS
        echo "ðŸŽ¯ ÐžÐ¢Ð§Ð•Ð¢ ÐžÐ‘ Ð£Ð¡ÐŸÐ•Ð¨ÐÐžÐ™ Ð¡Ð‘ÐžÐ ÐšÐ•" > build_success_report.txt
        echo "=============================" >> build_success_report.txt
        echo "Ð”Ð°Ñ‚Ð°: $(date)" >> build_success_report.txt
        echo "Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: âœ… Ð£Ð¡ÐŸÐ•Ð¨ÐÐž" >> build_success_report.txt
        echo "ÐžÑˆÐ¸Ð±ÐºÐ° 70: Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ" >> build_success_report.txt
        echo "" >> build_success_report.txt
        echo "Ð ÐµÑˆÐµÐ½Ð¸Ðµ:" >> build_success_report.txt
        echo "platform=iOS Simulator Ð²Ð¼ÐµÑÑ‚Ð¾ platform=iOS" >> build_success_report.txt
        echo "" >> build_success_report.txt
        echo ".app Ñ„Ð°Ð¹Ð»Ñ‹:" >> build_success_report.txt
        find build/ -name "*.app" -type d >> build_success_report.txt
        echo "" >> build_success_report.txt
        echo "Ð“Ð¾Ñ‚Ð¾Ð² Ð´Ð»Ñ App Store! ðŸš€" >> build_success_report.txt
        
    - name: Upload Success Report
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: ios-success-report
        path: mobile_apps/ALADDIN_iOS/build_success_report.txt
        retention-days: 30
