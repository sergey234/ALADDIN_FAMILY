name: iOS Final Test 5 - Perfect Solution
on:
  push:
    branches: [ main ]
    paths: [ 'mobile_apps/ALADDIN_iOS/final_test5.txt' ]
  workflow_dispatch:

jobs:
  perfect-solution:
    runs-on: macos-latest
    timeout-minutes: 10
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.0.0'
    
    - name: Run Perfect iOS Build
      run: |
        cd mobile_apps/ALADDIN_iOS
        echo "üéØ –¢–ï–°–¢ 5: –ò–î–ï–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï"
        echo "============================"
        echo ""
        echo "üîç –í–°–ï –ü–†–û–ë–õ–ï–ú–´:"
        echo "‚ùå Signing requires development team"
        echo "‚ùå SDK 22A3362 –Ω–µ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å runtime"
        echo "‚ùå Deployment target iOS 11.0 (—Ç—Ä–µ–±—É–µ—Ç—Å—è 12.0+)"
        echo "‚ùå Asset catalog runtime errors"
        echo ""
        echo "‚úÖ –ò–î–ï–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï:"
        echo "1. CODE_SIGNING_ALLOWED=NO (–æ—Ç–∫–ª—é—á–∞–µ–º –ø–æ–¥–ø–∏—Å—å)"
        echo "2. -sdk iphonesimulator (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π SDK)"
        echo "3. IPHONEOS_DEPLOYMENT_TARGET=13.0 (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π target)"
        echo "4. ASSETCATALOG_COMPILER_APPICON_NAME='' (–æ—Ç–∫–ª—é—á–∞–µ–º assets)"
        echo "5. -destination 'platform=iOS Simulator' (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π destination)"
        echo ""
        
        echo "üß™ –¢–ï–°–¢: –ò–¥–µ–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ"
        if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN \
          -sdk iphonesimulator \
          -destination "platform=iOS Simulator" \
          IPHONEOS_DEPLOYMENT_TARGET=13.0 \
          CODE_SIGNING_ALLOWED=NO \
          ASSETCATALOG_COMPILER_APPICON_NAME="" \
          ASSETCATALOG_COMPILER_ACCENT_COLOR_NAME="" \
          COMPILER_INDEX_STORE_ENABLE=NO \
          GCC_WARN_INHIBIT_ALL_WARNINGS=YES \
          build; then
          
          echo "‚úÖ –£–°–ü–ï–•! –ò–î–ï–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï –†–ê–ë–û–¢–ê–ï–¢!"
          
          echo ""
          echo "üì± –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏:"
          ls -la build/ || echo "build –ø–∞–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
          echo ""
          echo "üì± –ò—â–µ–º .app —Ñ–∞–π–ª—ã:"
          find build/ -name "*.app" -type d || echo ".app —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
          
          echo ""
          echo "üéâ –†–ï–®–ï–ù–ò–ï –ù–ê–ô–î–ï–ù–û!"
          echo "–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–∏:"
          echo "xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN \\"
          echo "  -sdk iphonesimulator \\"
          echo "  -destination 'platform=iOS Simulator' \\"
          echo "  IPHONEOS_DEPLOYMENT_TARGET=13.0 \\"
          echo "  CODE_SIGNING_ALLOWED=NO \\"
          echo "  ASSETCATALOG_COMPILER_APPICON_NAME='' \\"
          echo "  ASSETCATALOG_COMPILER_ACCENT_COLOR_NAME='' \\"
          echo "  COMPILER_INDEX_STORE_ENABLE=NO \\"
          echo "  GCC_WARN_INHIBIT_ALL_WARNINGS=YES \\"
          echo "  build"
          
        else
          echo "‚ùå –ò–¥–µ–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
          echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ SDK:"
          xcodebuild -showsdks | grep iphonesimulator
          echo ""
          echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ runtime:"
          xcrun simctl list runtimes | grep iOS | head -3
        fi
    
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      if: success()
      with:
        name: ios-perfect-solution
        path: mobile_apps/ALADDIN_iOS/build/
        if-no-files-found: warn
