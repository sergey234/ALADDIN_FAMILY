name: iOS Debug Test - Find the Real Problem

on:
  push:
    branches: [ main ]
    paths: [ 'mobile_apps/ALADDIN_iOS/debug_test.txt' ]

jobs:
  debug-test:
    runs-on: macos-latest
    timeout-minutes: 10
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Debug Test - Find the Real Problem
      run: |
        echo "üîç DEBUG –¢–ï–°–¢ - –ò–©–ï–ú –†–ï–ê–õ–¨–ù–£–Æ –ü–†–û–ë–õ–ï–ú–£"
        echo "======================================"
        
        echo "1Ô∏è‚É£ –ü–†–û–í–ï–†–Ø–ï–ú –û–ö–†–£–ñ–ï–ù–ò–ï:"
        echo "–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(pwd)"
        echo "–í–µ—Ä—Å–∏—è macOS: $(sw_vers)"
        echo "–í–µ—Ä—Å–∏—è Xcode: $(xcodebuild -version 2>/dev/null || echo 'Xcode –Ω–µ –Ω–∞–π–¥–µ–Ω')"
        
        echo ""
        echo "2Ô∏è‚É£ –ü–†–û–í–ï–†–Ø–ï–ú –§–ê–ô–õ–´ –ü–†–û–ï–ö–¢–ê:"
        ls -la mobile_apps/ALADDIN_iOS/ || echo "–ü–∞–ø–∫–∞ ALADDIN_iOS –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
        
        if [ -d "mobile_apps/ALADDIN_iOS" ]; then
          cd mobile_apps/ALADDIN_iOS
          echo "–ü–µ—Ä–µ—à–ª–∏ –≤ –ø–∞–ø–∫—É iOS –ø—Ä–æ–µ–∫—Ç–∞"
          echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏:"
          ls -la
          
          echo ""
          echo "3Ô∏è‚É£ –ü–†–û–í–ï–†–Ø–ï–ú .xcodeproj –§–ê–ô–õ:"
          if [ -f "ALADDIN.xcodeproj/project.pbxproj" ]; then
            echo "‚úÖ ALADDIN.xcodeproj –Ω–∞–π–¥–µ–Ω"
            echo "–†–∞–∑–º–µ—Ä: $(du -sh ALADDIN.xcodeproj)"
          else
            echo "‚ùå ALADDIN.xcodeproj –ù–ï –ù–ê–ô–î–ï–ù!"
            echo "–ò—â–µ–º .xcodeproj —Ñ–∞–π–ª—ã:"
            find . -name "*.xcodeproj" -type d
          fi
          
          echo ""
          echo "4Ô∏è‚É£ –ü–†–û–í–ï–†–Ø–ï–ú –°–•–ï–ú–´:"
          if [ -f "ALADDIN.xcodeproj/project.pbxproj" ]; then
            xcodebuild -project ALADDIN.xcodeproj -list || echo "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Ö–µ–º"
          fi
          
          echo ""
          echo "5Ô∏è‚É£ –ü–†–û–í–ï–†–Ø–ï–ú –°–ò–ú–£–õ–Ø–¢–û–†–´:"
          xcrun simctl list devices available | grep "iPhone" | head -3 || echo "iPhone —Å–∏–º—É–ª—è—Ç–æ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
          
          echo ""
          echo "6Ô∏è‚É£ –ü–†–û–ë–£–ï–ú –ü–†–û–°–¢–£–Æ –ö–û–ú–ü–ò–õ–Ø–¶–ò–Æ:"
          echo "–ö–æ–º–∞–Ω–¥–∞: xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -sdk iphonesimulator build"
          
          rm -rf build/
          if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -sdk iphonesimulator build; then
            echo "‚úÖ –ü–†–û–°–¢–ê–Ø –ö–û–ú–ü–ò–õ–Ø–¶–ò–Ø –†–ê–ë–û–¢–ê–ï–¢!"
            ls -la build/
            find build/ -name "*.app" -type d
          else
            echo "‚ùå –ü–†–û–°–¢–ê–Ø –ö–û–ú–ü–ò–õ–Ø–¶–ò–Ø –ù–ï –†–ê–ë–û–¢–ê–ï–¢"
            echo "–ü—Ä–æ–±—É–µ–º –±–µ–∑ —Å—Ö–µ–º—ã:"
            if xcodebuild -project ALADDIN.xcodeproj -sdk iphonesimulator build; then
              echo "‚úÖ –ö–û–ú–ü–ò–õ–Ø–¶–ò–Ø –ë–ï–ó –°–•–ï–ú–´ –†–ê–ë–û–¢–ê–ï–¢!"
              ls -la build/
            else
              echo "‚ùå –ö–û–ú–ü–ò–õ–Ø–¶–ò–Ø –ë–ï–ó –°–•–ï–ú–´ –¢–û–ñ–ï –ù–ï –†–ê–ë–û–¢–ê–ï–¢"
            fi
          fi
          
        else
          echo "‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ü–∞–ø–∫–∞ mobile_apps/ALADDIN_iOS –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
          echo "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:"
          find . -name "*.xcodeproj" -type d
        fi
        
    - name: Upload Debug Results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: ios-debug-test
        path: .
        retention-days: 1
