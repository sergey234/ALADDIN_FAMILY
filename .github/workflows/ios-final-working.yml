name: iOS Final Working Solution

on:
  push:
    branches: [ main ]
    paths: [ 'mobile_apps/ALADDIN_iOS/final_working.txt' ]

jobs:
  final-working:
    runs-on: macos-latest
    timeout-minutes: 10
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.0.0'
        
    - name: iOS Final Working Solution
      run: |
        echo "üéØ –§–ò–ù–ê–õ–¨–ù–û–ï –†–ê–ë–û–ß–ï–ï –†–ï–®–ï–ù–ò–ï"
        echo "============================"
        
        cd mobile_apps/ALADDIN_iOS
        
        echo ""
        echo "üîç –ü–†–û–ë–õ–ï–ú–ê –ù–ê–ô–î–ï–ù–ê:"
        echo "‚ùå –°–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π ID —Å–∏–º—É–ª—è—Ç–æ—Ä–∞"
        echo "‚ùå –≠—Ç–æ—Ç ID –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ GitHub Actions"
        echo "‚ùå iOS 18.0 is not installed"
        
        echo ""
        echo "‚úÖ –†–ï–®–ï–ù–ò–ï:"
        echo "–ò—Å–ø–æ–ª—å–∑—É–µ–º generic/platform=iOS Simulator –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ ID"
        
        echo ""
        echo "üß™ –¢–ï–°–¢ 1: Generic destination"
        if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -destination "generic/platform=iOS Simulator" build; then
          echo "‚úÖ –£–°–ü–ï–•! Generic destination —Ä–∞–±–æ—Ç–∞–µ—Ç!"
          
          echo ""
          echo "üì± –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏:"
          ls -la build/
          echo ""
          echo "üì± –ò—â–µ–º .app —Ñ–∞–π–ª—ã:"
          find build/ -name "*.app" -type d
          
          echo ""
          echo "üéâ –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï –ù–ê–ô–î–ï–ù–û!"
          echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: -destination 'generic/platform=iOS Simulator'"
          exit 0
        fi
        
        echo ""
        echo "üß™ –¢–ï–°–¢ 2: –ë–µ–∑ destination"
        if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN build; then
          echo "‚úÖ –£–°–ü–ï–•! –ë–µ–∑ destination —Ä–∞–±–æ—Ç–∞–µ—Ç!"
          
          echo ""
          echo "üì± –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏:"
          ls -la build/
          echo ""
          echo "üì± –ò—â–µ–º .app —Ñ–∞–π–ª—ã:"
          find build/ -name "*.app" -type d
          
          echo ""
          echo "üéâ –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–û–ï –†–ï–®–ï–ù–ò–ï!"
          echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –±–µ–∑ destination"
          exit 0
        fi
        
        echo ""
        echo "‚ùå –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å"
        echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–∏–º—É–ª—è—Ç–æ—Ä—ã:"
        xcrun simctl list devices available | grep iPhone | head -5
        
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: ios-final-working-artifacts
        path: mobile_apps/ALADDIN_iOS/build/
        retention-days: 7
