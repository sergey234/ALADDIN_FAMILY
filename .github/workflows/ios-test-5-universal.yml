name: iOS Test 5 - Universal Solution
on:
  push:
    branches: [ main ]
    paths: [ 'mobile_apps/ALADDIN_iOS/test5.txt' ]
  workflow_dispatch:

jobs:
  ios-test-5:
    runs-on: macos-latest
    timeout-minutes: 5
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.0.0'
    
    - name: iOS Test 5 - Universal Solution
      run: |
        cd mobile_apps/ALADDIN_iOS
        echo "üß™ –¢–ï–°–¢ 5: –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô - –ö–û–ú–ë–ò–ù–ò–†–û–í–ê–ù–ù–û–ï –†–ï–®–ï–ù–ò–ï"
        echo "=================================================="
        echo ""
        echo "üîç –ü–†–û–ë–õ–ï–ú–ê:"
        echo "‚ùå Runtime –≤–µ—Ä—Å–∏–∏ –Ω–µ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã"
        echo "‚ùå Deployment target —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä—ã–π (11.0)"
        echo "‚ùå Asset catalog —Ç—Ä–µ–±—É–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –≤–µ—Ä—Å–∏–∏"
        echo ""
        echo "‚úÖ –†–ï–®–ï–ù–ò–ï:"
        echo "–ö–æ–º–±–∏–Ω–∏—Ä—É–µ–º –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:"
        echo "1. SDK iphonesimulator"
        echo "2. Deployment target 13.0"
        echo "3. –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ warnings"
        echo ""
        echo "üß™ –¢–ï–°–¢: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ"
        if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -sdk iphonesimulator -destination "platform=iOS Simulator,name=iPhone 16 Pro" IPHONEOS_DEPLOYMENT_TARGET=13.0 GCC_WARN_INHIBIT_ALL_WARNINGS=YES COMPILER_INDEX_STORE_ENABLE=NO build; then
          echo "‚úÖ –£–°–ü–ï–•! –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!"
          
          echo ""
          echo "üì± –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏:"
          ls -la build/ || echo "build –ø–∞–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
          echo ""
          echo "üì± –ò—â–µ–º .app —Ñ–∞–π–ª—ã:"
          find build/ -name "*.app" -type d || echo ".app —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
          
          echo ""
          echo "üéâ –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï –ù–ê–ô–î–ï–ù–û!"
          echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
          echo "-sdk iphonesimulator"
          echo "IPHONEOS_DEPLOYMENT_TARGET=13.0"
          echo "GCC_WARN_INHIBIT_ALL_WARNINGS=YES"
          echo "COMPILER_INDEX_STORE_ENABLE=NO"
        else
          echo "‚ùå –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
          echo "–ü—Ä–æ–±—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é:"
          if xcodebuild -project ALADDIN.xcodeproj -scheme ALADDIN -sdk iphonesimulator IPHONEOS_DEPLOYMENT_TARGET=13.0 build; then
            echo "‚úÖ –£–°–ü–ï–•! –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!"
            echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: -sdk iphonesimulator IPHONEOS_DEPLOYMENT_TARGET=13.0"
          else
            echo "‚ùå –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ç–æ–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
            echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ runtime –µ—â–µ —Ä–∞–∑:"
            xcrun simctl list runtimes | grep iOS
          fi
        fi
