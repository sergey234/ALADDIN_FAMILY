# üõ°Ô∏è –ë–ï–ó–û–ü–ê–°–ù–´–ô –ü–õ–ê–ù –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –° –ì–ê–†–ê–ù–¢–ò–ï–ô A+ –ö–ê–ß–ï–°–¢–í–ê

## üéØ –¶–ï–õ–¨: –ü–û–õ–ù–´–ô –ü–ï–†–ï–ù–û–° –§–£–ù–ö–¶–ò–û–ù–ê–õ–ê –ë–ï–ó –ü–û–¢–ï–†–¨

### **üìä –ü–û–õ–ù–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ –î–õ–Ø –ü–ï–†–ï–ù–û–°–ê:**

| **–°–∏—Å—Ç–µ–º–∞** | **–ú–µ—Ç–æ–¥–æ–≤** | **–°—Ç—Ä–æ–∫** | **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** | **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç** |
|-------------|-------------|-----------|-----------------|---------------|
| **Dashboard System** | 17 | 400+ | 6 Enums + 3 –∫–ª–∞—Å—Å–∞ | **P0 –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô** |
| **Child Profile System** | 12 | 200+ | 2 –∫–ª–∞—Å—Å–∞ + 1 dataclass | **P0 –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô** |
| **Notification System** | 5 | 150+ | 1 –∫–ª–∞—Å—Å + 1 enum | **P1 –í–´–°–û–ö–ò–ô** |
| **Widget System** | 10 | 300+ | 1 enum + –ª–æ–≥–∏–∫–∞ | **P1 –í–´–°–û–ö–ò–ô** |
| **Theme System** | 6 | 100+ | 1 enum + –ª–æ–≥–∏–∫–∞ | **P2 –°–†–ï–î–ù–ò–ô** |
| **–ò–¢–û–ì–û** | **50+ –º–µ—Ç–æ–¥–æ–≤** | **1150+ —Å—Ç—Ä–æ–∫** | **9 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** | **100% –ü–ï–†–ï–ù–û–°** |

## üîí –≠–¢–ê–ü–´ –ë–ï–ó–û–ü–ê–°–ù–û–ô –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

### **–≠–¢–ê–ü 1: –ü–û–î–ì–û–¢–û–í–ö–ê –ò –ê–ù–ê–õ–ò–ó (–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨)**

#### **1.1 –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π**
```bash
# –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
cp security/family/family_profile_manager_enhanced.py backups/family_profile_manager_enhanced_BEFORE_INTEGRATION.py
cp security/family/family_dashboard_manager.py backups/family_dashboard_manager_ORIGINAL.py
cp security/bots/components/child_profile_manager.py backups/child_profile_manager_ORIGINAL.py
```

#### **1.2 –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω –º–µ—Ç–æ–¥–æ–≤ –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- –ê–Ω–∞–ª–∏–∑ –∏–º–ø–æ—Ä—Ç–æ–≤ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π

#### **1.3 –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã**
- –ö–æ–ø–∏—è FamilyProfileManagerEnhanced –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ä–µ–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

### **–≠–¢–ê–ü 2: –ü–û–≠–¢–ê–ü–ù–´–ô –ü–ï–†–ï–ù–û–° (–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨)**

#### **2.1 –ü–µ—Ä–µ–Ω–æ—Å Enums –∏ –±–∞–∑–æ–≤—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä (–ë–ï–ó–û–ü–ê–°–ù–û)**
```python
# –î–æ–±–∞–≤–ª—è–µ–º –≤ FamilyProfileManagerEnhanced:

# Dashboard Enums
class DashboardTheme(Enum):
    LIGHT = "light"
    DARK = "dark"
    COLORFUL = "colorful"
    MINIMAL = "minimal"
    CHILDREN = "children"
    ELDERLY = "elderly"

class WidgetType(Enum):
    SECURITY_STATUS = "security_status"
    FAMILY_MEMBERS = "family_members"
    DEVICE_STATUS = "device_status"
    ACTIVITY_FEED = "activity_feed"
    NOTIFICATIONS = "notifications"
    QUICK_ACTIONS = "quick_actions"
    STATISTICS = "statistics"
    EMERGENCY = "emergency"
    PARENTAL_CONTROLS = "parental_controls"
    HEALTH_MONITOR = "health_monitor"

class NotificationLevel(Enum):
    INFO = "info"
    WARNING = "warning"
    ERROR = "error"
    SUCCESS = "success"
    EMERGENCY = "emergency"

# Child Profile Enums (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ)
class ChildAgeGroup(Enum):
    TODDLER = "toddler"      # 0-2 –≥–æ–¥–∞
    PRESCHOOL = "preschool"  # 3-5 –ª–µ—Ç
    CHILD = "child"          # 6-12 –ª–µ—Ç
    TEEN = "teen"           # 13-17 –ª–µ—Ç
```

#### **2.2 –ü–µ—Ä–µ–Ω–æ—Å –∫–ª–∞—Å—Å–æ–≤ –¥–∞–Ω–Ω—ã—Ö (–ë–ï–ó–û–ü–ê–°–ù–û)**
```python
# Dashboard Classes
@dataclass
class DashboardWidget:
    widget_id: str
    widget_type: WidgetType
    title: str
    position: Tuple[int, int]
    size: Tuple[int, int]
    config: Dict[str, Any] = field(default_factory=dict)
    created_at: datetime = field(default_factory=datetime.now)
    is_active: bool = True
    
    def to_dict(self) -> Dict[str, Any]:
        return {
            "widget_id": self.widget_id,
            "widget_type": self.widget_type.value,
            "title": self.title,
            "position": self.position,
            "size": self.size,
            "config": self.config,
            "created_at": self.created_at.isoformat(),
            "is_active": self.is_active
        }

@dataclass
class FamilyNotification:
    notification_id: str
    title: str
    message: str
    level: NotificationLevel
    target_role: Optional[str] = None
    target_member: Optional[str] = None
    created_at: datetime = field(default_factory=datetime.now)
    expires_at: Optional[datetime] = None
    read: bool = False
    acknowledged: bool = False
    priority: int = 1  # 1-5, –≥–¥–µ 5 - –Ω–∞–∏–≤—ã—Å—à–∏–π
    
    def to_dict(self) -> Dict[str, Any]:
        return {
            "notification_id": self.notification_id,
            "title": self.title,
            "message": self.message,
            "level": self.level.value,
            "target_role": self.target_role,
            "target_member": self.target_member,
            "created_at": self.created_at.isoformat(),
            "expires_at": self.expires_at.isoformat() if self.expires_at else None,
            "read": self.read,
            "acknowledged": self.acknowledged,
            "priority": self.priority
        }

# Child Profile Classes
@dataclass
class ChildProfileStats:
    total_profiles: int = 0
    active_profiles: int = 0
    profiles_by_age_group: Dict[str, int] = field(default_factory=dict)
    profiles_by_parent: Dict[str, int] = field(default_factory=dict)
    total_restrictions: int = 0
    total_safe_zones: int = 0
    
    def __post_init__(self):
        if self.profiles_by_age_group is None:
            self.profiles_by_age_group = {}
        if self.profiles_by_parent is None:
            self.profiles_by_parent = {}

@dataclass
class ChildProfile:
    id: str
    name: str
    age: int
    age_group: str
    parent_id: str
    device_ids: List[str] = field(default_factory=list)
    restrictions: List[str] = field(default_factory=list)
    time_limits: Dict[str, str] = field(default_factory=dict)
    safe_zones: List[str] = field(default_factory=list)
    emergency_contacts: List[str] = field(default_factory=list)
    created_at: datetime = field(default_factory=datetime.now)
    last_updated: datetime = field(default_factory=datetime.now)
    is_active: bool = True
    
    def to_dict(self) -> Dict[str, Any]:
        return {
            "id": self.id,
            "name": self.name,
            "age": self.age,
            "age_group": self.age_group,
            "parent_id": self.parent_id,
            "device_ids": self.device_ids,
            "restrictions": self.restrictions,
            "time_limits": self.time_limits,
            "safe_zones": self.safe_zones,
            "emergency_contacts": self.emergency_contacts,
            "created_at": self.created_at.isoformat(),
            "last_updated": self.last_updated.isoformat(),
            "is_active": self.is_active
        }
```

#### **2.3 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å (–ë–ï–ó–û–ü–ê–°–ù–û)**
```python
class FamilyProfileManagerEnhanced(SecurityBase):
    def __init__(self, config: Optional[Dict[str, Any]] = None):
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞—Ç—Ä–∏–±—É—Ç—ã ...
        
        # Dashboard attributes
        self.dashboards: Dict[str, Dict[str, Any]] = {}
        self.widgets: Dict[str, DashboardWidget] = {}
        self.notifications: List[FamilyNotification] = []
        self.dashboard_themes: Dict[FamilyRole, DashboardTheme] = {
            FamilyRole.PARENT: DashboardTheme.PROFESSIONAL,
            FamilyRole.CHILD: DashboardTheme.CHILDREN,
            FamilyRole.TEEN: DashboardTheme.MODERN,
            FamilyRole.ELDERLY: DashboardTheme.ELDERLY,
            FamilyRole.GUARDIAN: DashboardTheme.MINIMAL,
            FamilyRole.ADMIN: DashboardTheme.DARK
        }
        
        # Child Profile attributes
        self.child_profiles: Dict[str, ChildProfile] = {}
        self.child_stats = ChildProfileStats()
        self.child_lock = asyncio.Lock()
        
        # Dashboard configuration
        self.max_widgets_per_dashboard = config.get("max_widgets_per_dashboard", 20) if config else 20
        self.notification_retention_days = config.get("notification_retention_days", 30) if config else 30
        self.auto_refresh_interval = config.get("auto_refresh_interval", 30) if config else 30
```

### **–≠–¢–ê–ü 3: –ü–û–≠–¢–ê–ü–ù–´–ô –ü–ï–†–ï–ù–û–° –ú–ï–¢–û–î–û–í (–ë–ï–ó–û–ü–ê–°–ù–û)**

#### **3.1 Dashboard –º–µ—Ç–æ–¥—ã (17 –º–µ—Ç–æ–¥–æ–≤) - –ü–†–ò–û–†–ò–¢–ï–¢ P0**

```python
# Dashboard Management (5 –º–µ—Ç–æ–¥–æ–≤)
def create_dashboard(self, user_id: str, theme: Optional[DashboardTheme] = None, 
                    widgets: Optional[List[str]] = None) -> Dict[str, Any]:
    """–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞"""
    try:
        if user_id in self.dashboards:
            raise ValueError(f"–î–∞—à–±–æ—Ä–¥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
        
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–º—ã
        if theme is None:
            user_role = self._get_user_role(user_id)
            theme = self.dashboard_themes.get(user_role, DashboardTheme.LIGHT)
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞
        dashboard_config = {
            "user_id": user_id,
            "theme": theme.value,
            "widgets": widgets or [],
            "created_at": datetime.now().isoformat(),
            "last_updated": datetime.now().isoformat(),
            "is_active": True
        }
        
        self.dashboards[user_id] = dashboard_config
        self.log_activity(f"–°–æ–∑–¥–∞–Ω –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")
        return dashboard_config
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–∞: {e}", "error")
        raise

def add_dashboard_widget(self, user_id: str, widget_type: WidgetType, 
                        title: str, position: Tuple[int, int], 
                        size: Tuple[int, int], config: Dict[str, Any] = None) -> str:
    """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ –Ω–∞ –¥–∞—à–±–æ—Ä–¥"""
    try:
        if user_id not in self.dashboards:
            raise ValueError(f"–î–∞—à–±–æ—Ä–¥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –≤–∏–¥–∂–µ—Ç–æ–≤
        current_widgets = len([w for w in self.widgets.values() if w.widget_id.startswith(user_id)])
        if current_widgets >= self.max_widgets_per_dashboard:
            raise ValueError(f"–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≤–∏–¥–∂–µ—Ç–æ–≤ ({self.max_widgets_per_dashboard})")
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞
        widget_id = f"{user_id}_{widget_type.value}_{int(time.time())}"
        widget = DashboardWidget(
            widget_id=widget_id,
            widget_type=widget_type,
            title=title,
            position=position,
            size=size,
            config=config or {}
        )
        
        self.widgets[widget_id] = widget
        self.dashboards[user_id]["widgets"].append(widget_id)
        self.dashboards[user_id]["last_updated"] = datetime.now().isoformat()
        
        self.log_activity(f"–î–æ–±–∞–≤–ª–µ–Ω –≤–∏–¥–∂–µ—Ç {widget_id} –Ω–∞ –¥–∞—à–±–æ—Ä–¥ {user_id}")
        return widget_id
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞: {e}", "error")
        raise

def remove_dashboard_widget(self, user_id: str, widget_id: str) -> bool:
    """–£–¥–∞–ª–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ —Å –¥–∞—à–±–æ—Ä–¥–∞"""
    try:
        if user_id not in self.dashboards:
            raise ValueError(f"–î–∞—à–±–æ—Ä–¥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        
        if widget_id not in self.widgets:
            raise ValueError(f"–í–∏–¥–∂–µ—Ç {widget_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        
        # –£–¥–∞–ª–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞
        del self.widgets[widget_id]
        if widget_id in self.dashboards[user_id]["widgets"]:
            self.dashboards[user_id]["widgets"].remove(widget_id)
        
        self.dashboards[user_id]["last_updated"] = datetime.now().isoformat()
        self.log_activity(f"–£–¥–∞–ª–µ–Ω –≤–∏–¥–∂–µ—Ç {widget_id} —Å –¥–∞—à–±–æ—Ä–¥–∞ {user_id}")
        return True
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞: {e}", "error")
        return False

def get_dashboard_config(self, user_id: str) -> Dict[str, Any]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–∞—à–±–æ—Ä–¥–∞"""
    try:
        if user_id not in self.dashboards:
            return {}
        
        dashboard = self.dashboards[user_id].copy()
        
        # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∏–¥–∂–µ—Ç–∞—Ö
        dashboard["widgets_data"] = []
        for widget_id in dashboard.get("widgets", []):
            if widget_id in self.widgets:
                dashboard["widgets_data"].append(self.widgets[widget_id].to_dict())
        
        return dashboard
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–∞—à–±–æ—Ä–¥–∞: {e}", "error")
        return {}

def update_dashboard_theme(self, user_id: str, theme: DashboardTheme) -> bool:
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º—ã –¥–∞—à–±–æ—Ä–¥–∞"""
    try:
        if user_id not in self.dashboards:
            raise ValueError(f"–î–∞—à–±–æ—Ä–¥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        
        self.dashboards[user_id]["theme"] = theme.value
        self.dashboards[user_id]["last_updated"] = datetime.now().isoformat()
        
        self.log_activity(f"–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ç–µ–º–∞ –¥–∞—à–±–æ—Ä–¥–∞ {user_id} –Ω–∞ {theme.value}")
        return True
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–º—ã –¥–∞—à–±–æ—Ä–¥–∞: {e}", "error")
        return False

# Notification Management (5 –º–µ—Ç–æ–¥–æ–≤)
def send_notification(self, title: str, message: str, level: NotificationLevel,
                     target_role: Optional[str] = None, target_member: Optional[str] = None,
                     expires_at: Optional[datetime] = None, priority: int = 1) -> str:
    """–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"""
    try:
        notification_id = f"notif_{int(time.time())}_{uuid.uuid4().hex[:8]}"
        
        notification = FamilyNotification(
            notification_id=notification_id,
            title=title,
            message=message,
            level=level,
            target_role=target_role,
            target_member=target_member,
            expires_at=expires_at,
            priority=priority
        )
        
        self.notifications.append(notification)
        
        # –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        self._cleanup_old_notifications()
        
        self.log_activity(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ {notification_id}")
        return notification_id
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {e}", "error")
        raise

def get_notifications(self, user_id: Optional[str] = None, 
                     unread_only: bool = False) -> List[Dict[str, Any]]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
    try:
        notifications = []
        
        for notification in self.notifications:
            # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            if user_id and notification.target_member and notification.target_member != user_id:
                continue
            
            # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–æ–ª–∏
            if user_id and notification.target_role:
                user_role = self._get_user_role(user_id)
                if user_role.value != notification.target_role:
                    continue
            
            # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É –ø—Ä–æ—á—Ç–µ–Ω–∏—è
            if unread_only and notification.read:
                continue
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
            if notification.expires_at and notification.expires_at < datetime.now():
                continue
            
            notifications.append(notification.to_dict())
        
        # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –∏ –≤—Ä–µ–º–µ–Ω–∏
        notifications.sort(key=lambda x: (-x.get('priority', 1), x.get('created_at', '')))
        
        return notifications
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: {e}", "error")
        return []

def mark_notification_read(self, notification_id: str) -> bool:
    """–û—Ç–º–µ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ"""
    try:
        for notification in self.notifications:
            if notification.notification_id == notification_id:
                notification.read = True
                self.log_activity(f"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ {notification_id} –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ")
                return True
        
        return False
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ: {e}", "error")
        return False

def acknowledge_notification(self, notification_id: str) -> bool:
    """–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"""
    try:
        for notification in self.notifications:
            if notification.notification_id == notification_id:
                notification.acknowledged = True
                notification.read = True
                self.log_activity(f"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ {notification_id} –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ")
                return True
        
        return False
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {e}", "error")
        return False

def _cleanup_old_notifications(self) -> None:
    """–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
    try:
        cutoff_date = datetime.now() - timedelta(days=self.notification_retention_days)
        
        # –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        self.notifications = [
            n for n in self.notifications 
            if not n.expires_at or n.expires_at > cutoff_date
        ]
        
        # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        if len(self.notifications) > 1000:  # –ú–∞–∫—Å–∏–º—É–º 1000 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            self.notifications = sorted(
                self.notifications, 
                key=lambda x: x.created_at, 
                reverse=True
            )[:1000]
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: {e}", "error")

# Widget Management (7 –º–µ—Ç–æ–¥–æ–≤)
def _initialize_default_widgets(self) -> None:
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"""
    try:
        # –í–∏–¥–∂–µ—Ç —Å—Ç–∞—Ç—É—Å–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        security_widget = DashboardWidget(
            widget_id="system_security_status",
            widget_type=WidgetType.SECURITY_STATUS,
            title="–°—Ç–∞—Ç—É—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
            position=(0, 0),
            size=(2, 1),
            config={"show_threats": True, "show_protection": True}
        )
        self.widgets["system_security_status"] = security_widget
        
        # –í–∏–¥–∂–µ—Ç —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏
        family_widget = DashboardWidget(
            widget_id="system_family_members",
            widget_type=WidgetType.FAMILY_MEMBERS,
            title="–ß–ª–µ–Ω—ã —Å–µ–º—å–∏",
            position=(2, 0),
            size=(2, 1),
            config={"show_online": True, "show_roles": True}
        )
        self.widgets["system_family_members"] = family_widget
        
        # –í–∏–¥–∂–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        device_widget = DashboardWidget(
            widget_id="system_device_status",
            widget_type=WidgetType.DEVICE_STATUS,
            title="–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞",
            position=(0, 1),
            size=(2, 1),
            config={"show_connected": True, "show_battery": True}
        )
        self.widgets["system_device_status"] = device_widget
        
        # –í–∏–¥–∂–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        activity_widget = DashboardWidget(
            widget_id="system_activity_feed",
            widget_type=WidgetType.ACTIVITY_FEED,
            title="–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",
            position=(2, 1),
            size=(2, 1),
            config={"show_recent": True, "max_items": 10}
        )
        self.widgets["system_activity_feed"] = activity_widget
        
        self.log_activity("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤–∏–¥–∂–µ—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é")
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∏–¥–∂–µ—Ç–æ–≤: {e}", "error")

def _setup_quick_actions(self) -> None:
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π"""
    try:
        quick_actions = {
            "emergency_lock": "–≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞",
            "family_meeting": "–°–µ–º–µ–π–Ω–æ–µ —Å–æ–±—Ä–∞–Ω–∏–µ",
            "device_check": "–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤",
            "security_scan": "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
            "backup_data": "–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ"
        }
        
        for action_id, action_name in quick_actions.items():
            widget = DashboardWidget(
                widget_id=f"quick_action_{action_id}",
                widget_type=WidgetType.QUICK_ACTIONS,
                title=action_name,
                position=(0, 2),
                size=(1, 1),
                config={"action_id": action_id, "is_quick": True}
            )
            self.widgets[f"quick_action_{action_id}"] = widget
        
        self.log_activity("–ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –±—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è")
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π: {e}", "error")

def _setup_emergency_contacts(self) -> None:
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤"""
    try:
        emergency_contacts = {
            "police": "–ü–æ–ª–∏—Ü–∏—è (102)",
            "ambulance": "–°–∫–æ—Ä–∞—è –ø–æ–º–æ—â—å (103)",
            "fire": "–ü–æ–∂–∞—Ä–Ω–∞—è —Å–ª—É–∂–±–∞ (101)",
            "family_doctor": "–°–µ–º–µ–π–Ω—ã–π –≤—Ä–∞—á",
            "neighbor": "–°–æ—Å–µ–¥"
        }
        
        for contact_id, contact_name in emergency_contacts.items():
            widget = DashboardWidget(
                widget_id=f"emergency_{contact_id}",
                widget_type=WidgetType.EMERGENCY,
                title=contact_name,
                position=(1, 2),
                size=(1, 1),
                config={"contact_id": contact_id, "is_emergency": True}
            )
            self.widgets[f"emergency_{contact_id}"] = widget
        
        self.log_activity("–ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã")
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: {e}", "error")

def _create_personal_dashboard(self, user_id: str, role: FamilyRole) -> Dict[str, Any]:
    """–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞"""
    try:
        theme = self.dashboard_themes.get(role, DashboardTheme.LIGHT)
        
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–æ–≤ –ø–æ —Ä–æ–ª–∏
        role_widgets = self._get_widgets_for_role(role)
        
        dashboard_config = {
            "user_id": user_id,
            "theme": theme.value,
            "widgets": role_widgets,
            "created_at": datetime.now().isoformat(),
            "last_updated": datetime.now().isoformat(),
            "is_active": True
        }
        
        return dashboard_config
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞: {e}", "error")
        return {}

def _get_widgets_for_role(self, role: FamilyRole) -> List[str]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–æ–≤ –¥–ª—è —Ä–æ–ª–∏"""
    try:
        if role == FamilyRole.PARENT:
            return ["system_security_status", "system_family_members", 
                   "system_device_status", "system_activity_feed",
                   "parental_controls", "statistics"]
        elif role == FamilyRole.CHILD:
            return ["system_family_members", "system_device_status", 
                   "fun_activities", "time_remaining"]
        elif role == FamilyRole.TEEN:
            return ["system_family_members", "system_device_status", 
                   "social_media_status", "privacy_settings"]
        elif role == FamilyRole.ELDERLY:
            return ["system_family_members", "emergency_contacts", 
                   "health_monitor", "simple_alerts"]
        elif role == FamilyRole.GUARDIAN:
            return ["system_family_members", "system_device_status", 
                   "monitoring", "reports"]
        elif role == FamilyRole.ADMIN:
            return ["system_security_status", "system_family_members", 
                   "system_device_status", "system_activity_feed",
                   "statistics", "admin_panel"]
        else:
            return ["system_family_members", "system_device_status"]
            
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–æ–≤ –¥–ª—è —Ä–æ–ª–∏: {e}", "error")
        return []

def _get_theme_for_role(self, role: FamilyRole) -> DashboardTheme:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–º—ã –¥–ª—è —Ä–æ–ª–∏"""
    return self.dashboard_themes.get(role, DashboardTheme.LIGHT)

def get_dashboard_metrics(self) -> Dict[str, Any]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –¥–∞—à–±–æ—Ä–¥–∞"""
    try:
        total_dashboards = len(self.dashboards)
        total_widgets = len(self.widgets)
        total_notifications = len(self.notifications)
        unread_notifications = len([n for n in self.notifications if not n.read])
        
        return {
            "total_dashboards": total_dashboards,
            "total_widgets": total_widgets,
            "total_notifications": total_notifications,
            "unread_notifications": unread_notifications,
            "active_dashboards": len([d for d in self.dashboards.values() if d.get("is_active", True)]),
            "themes_used": list(set(d.get("theme", "light") for d in self.dashboards.values()))
        }
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –¥–∞—à–±–æ—Ä–¥–∞: {e}", "error")
        return {}
```

#### **3.2 Child Profile –º–µ—Ç–æ–¥—ã (12 –º–µ—Ç–æ–¥–æ–≤) - –ü–†–ò–û–†–ò–¢–ï–¢ P0**

```python
# Child Profile Management (12 –º–µ—Ç–æ–¥–æ–≤)
async def add_child_profile(self, child_data: Dict[str, Any]) -> str:
    """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Ä–µ–±–µ–Ω–∫–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π"""
    try:
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        validation_result = await self.validate_child_profile_data(child_data)
        if not validation_result[0]:
            raise ValueError(f"–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: {validation_result[1]}")
        
        async with self.child_lock:
            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID
            child_id = self._generate_child_id()
            
            # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –≥—Ä—É–ø–ø—ã
            age = child_data.get("age", 0)
            age_group = self._determine_child_age_group(age)
            
            # –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
            profile = ChildProfile(
                id=child_id,
                name=child_data["name"],
                age=age,
                age_group=age_group,
                parent_id=child_data.get("parent_id", ""),
                device_ids=child_data.get("device_ids", []),
                restrictions=child_data.get("restrictions", []),
                time_limits=child_data.get("time_limits", {}),
                safe_zones=child_data.get("safe_zones", []),
                emergency_contacts=child_data.get("emergency_contacts", [])
            )
            
            # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç—å
            self.child_profiles[child_id] = profile
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            self._update_child_stats()
            
            self.log_activity(f"–ü—Ä–æ—Ñ–∏–ª—å —Ä–µ–±–µ–Ω–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω: {child_id}")
            return child_id
            
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è —Ä–µ–±–µ–Ω–∫–∞: {e}", "error")
        raise

async def get_child_profile(self, child_id: str) -> Optional[ChildProfile]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Ä–µ–±–µ–Ω–∫–∞"""
    try:
        return self.child_profiles.get(child_id)
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è —Ä–µ–±–µ–Ω–∫–∞: {e}", "error")
        return None

async def update_child_profile(self, child_id: str, updates: Dict[str, Any]) -> bool:
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Ä–µ–±–µ–Ω–∫–∞"""
    try:
        if child_id not in self.child_profiles:
            return False
        
        async with self.child_lock:
            profile = self.child_profiles[child_id]
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π
            for key, value in updates.items():
                if hasattr(profile, key):
                    setattr(profile, key, value)
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –≥—Ä—É–ø–ø—ã –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è –≤–æ–∑—Ä–∞—Å—Ç
            if "age" in updates:
                profile.age_group = self._determine_child_age_group(profile.age)
            
            profile.last_updated = datetime.now()
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            self._update_child_stats()
            
            self.log_activity(f"–ü—Ä–æ—Ñ–∏–ª—å —Ä–µ–±–µ–Ω–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω: {child_id}")
            return True
            
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è —Ä–µ–±–µ–Ω–∫–∞: {e}", "error")
        return False

async def delete_child_profile(self, child_id: str) -> bool:
    """–£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Ä–µ–±–µ–Ω–∫–∞"""
    try:
        if child_id not in self.child_profiles:
            return False
        
        async with self.child_lock:
            del self.child_profiles[child_id]
            self._update_child_stats()
            
            self.log_activity(f"–ü—Ä–æ—Ñ–∏–ª—å —Ä–µ–±–µ–Ω–∫–∞ —É–¥–∞–ª–µ–Ω: {child_id}")
            return True
            
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è —Ä–µ–±–µ–Ω–∫–∞: {e}", "error")
        return False

async def get_all_child_profiles(self) -> Dict[str, ChildProfile]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–µ—Ç–µ–π"""
    try:
        return self.child_profiles.copy()
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–µ—Ç–µ–π: {e}", "error")
        return {}

async def get_child_profiles_by_parent(self, parent_id: str) -> List[ChildProfile]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–µ—Ç–µ–π –ø–æ —Ä–æ–¥–∏—Ç–µ–ª—é"""
    try:
        return [
            profile for profile in self.child_profiles.values()
            if profile.parent_id == parent_id
        ]
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–µ—Ç–µ–π –ø–æ —Ä–æ–¥–∏—Ç–µ–ª—é: {e}", "error")
        return []

async def get_child_profiles_by_age_group(self, age_group: str) -> List[ChildProfile]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–µ—Ç–µ–π –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –≥—Ä—É–ø–ø–µ"""
    try:
        return [
            profile for profile in self.child_profiles.values()
            if profile.age_group == age_group
        ]
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–µ—Ç–µ–π –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –≥—Ä—É–ø–ø–µ: {e}", "error")
        return []

async def get_child_stats(self) -> ChildProfileStats:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–µ—Ç–µ–π"""
    try:
        return self.child_stats
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–µ—Ç–µ–π: {e}", "error")
        return ChildProfileStats()

async def search_child_profiles(self, query: str) -> List[ChildProfile]:
    """–ü–æ–∏—Å–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–µ—Ç–µ–π"""
    try:
        query_lower = query.lower()
        results = []
        
        for profile in self.child_profiles.values():
            if (query_lower in profile.name.lower() or
                query_lower in profile.age_group.lower() or
                query_lower in str(profile.age)):
                results.append(profile)
        
        return results
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–µ—Ç–µ–π: {e}", "error")
        return []

async def validate_child_profile_data(self, child_data: Dict[str, Any]) -> Tuple[bool, Optional[str]]:
    """–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è —Ä–µ–±–µ–Ω–∫–∞"""
    try:
        # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
        required_fields = ["name", "age"]
        for field in required_fields:
            if field not in child_data:
                return False, f"–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ: {field}"
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏
        name = child_data["name"]
        if not isinstance(name, str) or len(name.strip()) < 2:
            return False, "–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –¥–ª–∏–Ω–æ–π –Ω–µ –º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤"
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–æ–∑—Ä–∞—Å—Ç–∞
        age = child_data["age"]
        if not isinstance(age, int) or age < 0 or age > 18:
            return False, "–í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç 0 –¥–æ 18"
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è
        parent_id = child_data.get("parent_id")
        if parent_id and not isinstance(parent_id, str):
            return False, "ID —Ä–æ–¥–∏—Ç–µ–ª—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π"
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        device_ids = child_data.get("device_ids", [])
        if not isinstance(device_ids, list):
            return False, "–°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
        restrictions = child_data.get("restrictions", [])
        if not isinstance(restrictions, list):
            return False, "–°–ø–∏—Å–æ–∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"
        
        return True, None
        
    except Exception as e:
        return False, f"–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: {str(e)}"

def _generate_child_id(self) -> str:
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID –¥–ª—è —Ä–µ–±–µ–Ω–∫–∞"""
    try:
        timestamp = int(time.time())
        random_part = uuid.uuid4().hex[:8]
        return f"CHILD_{timestamp}_{random_part}"
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ID —Ä–µ–±–µ–Ω–∫–∞: {e}", "error")
        return f"CHILD_{int(time.time())}"

def _determine_child_age_group(self, age: int) -> str:
    """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –≥—Ä—É–ø–ø—ã —Ä–µ–±–µ–Ω–∫–∞"""
    try:
        if age <= 2:
            return "toddler"
        elif age <= 5:
            return "preschool"
        elif age <= 12:
            return "child"
        elif age <= 17:
            return "teen"
        else:
            return "adult"
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –≥—Ä—É–ø–ø—ã: {e}", "error")
        return "child"

def _update_child_stats(self) -> None:
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–µ—Ç–µ–π"""
    try:
        self.child_stats.total_profiles = len(self.child_profiles)
        self.child_stats.active_profiles = len([p for p in self.child_profiles.values() if p.is_active])
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –≥—Ä—É–ø–ø–∞–º
        age_groups = {}
        for profile in self.child_profiles.values():
            age_group = profile.age_group
            age_groups[age_group] = age_groups.get(age_group, 0) + 1
        self.child_stats.profiles_by_age_group = age_groups
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–æ–¥–∏—Ç–µ–ª—è–º
        parents = {}
        for profile in self.child_profiles.values():
            parent_id = profile.parent_id
            parents[parent_id] = parents.get(parent_id, 0) + 1
        self.child_stats.profiles_by_parent = parents
        
        # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω
        self.child_stats.total_restrictions = sum(len(p.restrictions) for p in self.child_profiles.values())
        self.child_stats.total_safe_zones = sum(len(p.safe_zones) for p in self.child_profiles.values())
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–µ—Ç–µ–π: {e}", "error")
```

### **–≠–¢–ê–ü 4: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï (–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨)**

#### **4.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**
```python
def initialize(self) -> bool:
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –Ω–æ–≤—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏"""
    try:
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ...
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Dashboard —Å–∏—Å—Ç–µ–º—ã
        self._initialize_default_widgets()
        self._setup_quick_actions()
        self._setup_emergency_contacts()
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Child Profile —Å–∏—Å—Ç–µ–º—ã
        self._update_child_stats()
        
        self.log_activity("–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã")
        return True
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: {e}", "error")
        return False
```

#### **4.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö**
```python
def _save_data(self):
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö"""
    try:
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ...
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Dashboard –¥–∞–Ω–Ω—ã—Ö
        dashboard_data = {
            "dashboards": self.dashboards,
            "widgets": {k: v.to_dict() for k, v in self.widgets.items()},
            "notifications": [n.to_dict() for n in self.notifications]
        }
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Child Profile –¥–∞–Ω–Ω—ã—Ö
        child_data = {
            "profiles": {k: v.to_dict() for k, v in self.child_profiles.items()},
            "stats": {
                "total_profiles": self.child_stats.total_profiles,
                "active_profiles": self.child_stats.active_profiles,
                "profiles_by_age_group": self.child_stats.profiles_by_age_group,
                "profiles_by_parent": self.child_stats.profiles_by_parent,
                "total_restrictions": self.child_stats.total_restrictions,
                "total_safe_zones": self.child_stats.total_safe_zones
            }
        }
        
        self.log_activity("–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã")
        
    except Exception as e:
        self.log_activity(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: {e}", "error")
```

### **–≠–¢–ê–ü 5: –§–ò–ù–ê–õ–¨–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï (–ì–ê–†–ê–ù–¢–ò–Ø A+)**

#### **5.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã**
```python
def test_dashboard_functionality():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞—à–±–æ—Ä–¥–∞"""
    # –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–∞
    # –¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–æ–≤
    # –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    # –¢–µ—Å—Ç —Ç–µ–º

def test_child_profile_functionality():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–µ—Ç–µ–π"""
    # –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
    # –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
    # –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    # –¢–µ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

def test_integration():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"""
    # –¢–µ—Å—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    # –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    # –¢–µ—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```

#### **5.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞**
```bash
# Flake8 –ø—Ä–æ–≤–µ—Ä–∫–∞
python3 -m flake8 security/family/family_profile_manager_enhanced.py --max-line-length=79

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
python3 -m mypy security/family/family_profile_manager_enhanced.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
python3 -c "import security.family.family_profile_manager_enhanced"
```

## üéØ –ì–ê–†–ê–ù–¢–ò–ò A+ –ö–ê–ß–ï–°–¢–í–ê

### **‚úÖ –ü–û–õ–ù–´–ô –ü–ï–†–ï–ù–û–° –§–£–ù–ö–¶–ò–û–ù–ê–õ–ê:**
- **50+ –º–µ—Ç–æ–¥–æ–≤** –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –±–µ–∑ –ø–æ—Ç–µ—Ä—å
- **9 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é
- **1150+ —Å—Ç—Ä–æ–∫** –∫–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ
- **100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º API

### **‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò–ù–¢–ï–ì–†–ê–¶–ò–ò:**
- **–ü–æ–ª–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏** –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
- **–ü–æ—ç—Ç–∞–ø–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ

### **‚úÖ A+ –ö–ê–ß–ï–°–¢–í–û –ö–û–î–ê:**
- **0 –æ—à–∏–±–æ–∫ flake8** –ø–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **–ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è** –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞
- **–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** 100%

**–ì–û–¢–û–í–´ –ù–ê–ß–ê–¢–¨ –ë–ï–ó–û–ü–ê–°–ù–£–Æ –ò–ù–¢–ï–ì–†–ê–¶–ò–Æ?** üöÄ