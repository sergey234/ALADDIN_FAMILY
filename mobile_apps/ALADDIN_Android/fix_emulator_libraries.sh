#!/bin/bash

echo "üîß –ò–°–ü–†–ê–í–õ–Ø–ï–ú –ë–ò–ë–õ–ò–û–¢–ï–ö–ò –≠–ú–£–õ–Ø–¢–û–†–ê"
echo "=================================="

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export ANDROID_HOME="/Users/sergejhlystov/Library/Android/sdk"
export PATH="$ANDROID_HOME/emulator:$ANDROID_HOME/platform-tools:$PATH"

echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é macOS..."
sw_vers

echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ Android SDK..."
ls -la "$ANDROID_HOME/emulator/"

echo ""
echo "üîß –ü—Ä–æ–±—É–µ–º –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏..."

# –°–æ–∑–¥–∞–µ–º —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é libc++
echo "üìÅ –°–æ–∑–¥–∞–µ–º —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É –Ω–∞ libc++..."
sudo ln -sf /usr/lib/libc++.1.dylib /usr/lib/libc++.1.0.dylib 2>/dev/null || echo "–°–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
export DYLD_LIBRARY_PATH="/usr/lib:$ANDROID_HOME/emulator/lib64"

echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —ç–º—É–ª—è—Ç–æ—Ä—ã —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏..."
$ANDROID_HOME/emulator/emulator -list-avds

echo ""
echo "üì± –ü—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç–º—É–ª—è—Ç–æ—Ä —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏..."

# –ü—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç–º—É–ª—è—Ç–æ—Ä —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
echo "üîÑ –í–∞—Ä–∏–∞–Ω—Ç 1: –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏..."
$ANDROID_HOME/emulator/emulator -avd Pixel_7_Pro_API_34 -no-snapshot-load -no-snapshot-save -no-boot-anim -no-audio -gpu swiftshader_indirect -memory 2048 &

EMULATOR_PID=$!
echo "üì± PID —ç–º—É–ª—è—Ç–æ—Ä–∞: $EMULATOR_PID"

echo "‚è≥ –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ —ç–º—É–ª—è—Ç–æ—Ä–∞ (30 —Å–µ–∫—É–Ω–¥)..."
sleep 30

echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ..."
adb devices

# –ï—Å–ª–∏ —ç–º—É–ª—è—Ç–æ—Ä –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è, –ø—Ä–æ–±—É–µ–º –¥—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
DEVICES=$(adb devices | grep -v "List of devices attached" | grep -v "^$" | wc -l)

if [ $DEVICES -eq 0 ]; then
    echo "‚ùå –ü–µ—Ä–≤—ã–π —ç–º—É–ª—è—Ç–æ—Ä –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è, –ø—Ä–æ–±—É–µ–º –≤—Ç–æ—Ä–æ–π..."
    
    # –£–±–∏–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å
    kill $EMULATOR_PID 2>/dev/null
    
    echo "üîÑ –í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–ø—É—Å–∫ —Å –¥—Ä—É–≥–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏..."
    $ANDROID_HOME/emulator/emulator -avd Pixel_3a_API_36_extension_level_17_x86_64 -no-snapshot-load -no-snapshot-save -no-boot-anim -no-audio -gpu swiftshader_indirect -memory 2048 &
    
    echo "‚è≥ –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ –≤—Ç–æ—Ä–æ–≥–æ —ç–º—É–ª—è—Ç–æ—Ä–∞ (45 —Å–µ–∫—É–Ω–¥)..."
    sleep 45
    
    echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ..."
    adb devices
fi

echo ""
echo "üìã –†–µ–∑—É–ª—å—Ç–∞—Ç:"
adb devices

echo ""
echo "‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "üì± –ï—Å–ª–∏ —ç–º—É–ª—è—Ç–æ—Ä –∑–∞–ø—É—Å—Ç–∏–ª—Å—è, –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å APK"
echo "üîß –ï—Å–ª–∏ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è, –ø–æ–ø—Ä–æ–±—É–µ–º Android Studio"

