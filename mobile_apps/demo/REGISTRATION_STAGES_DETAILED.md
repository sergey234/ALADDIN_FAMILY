# 📋 ДЕТАЛЬНАЯ СХЕМА ВСЕХ ЭТАПОВ РЕГИСТРАЦИИ

## ✅ ВСЕ 8 ОКОН РЕГИСТРАЦИИ

| # | Название | Что делает | Что формируется | Что видит пользователь |
|---|----------|------------|-----------------|------------------------|
| **1️⃣** | **Роль** | Выбор роли в семье | НИЧЕГО (только сохраняется выбор) | 4 карточки: Родитель/Ребёнок/Пожилой/Человек |
| **2️⃣** | **Возраст** | Выбор возрастной группы | НИЧЕГО (только сохраняется выбор) | 6 вариантов: 1-6/7-12/13-17/18-23/24-55/56+ |
| **3️⃣** | **Буква** | Выбор персональной буквы | НИЧЕГО (только сохраняется выбор) | Сетка 33 буквы (А-Я) |
| **4️⃣** | **Семья создана** | Показ кода восстановления | **ВСЁ ФОРМИРУЕТСЯ ЗДЕСЬ!** | QR-код картинка + код FAM-A1B2-C3D4-E5F6 |
| **5️⃣** | **QR Scanner** | Сканирование QR-кода | НИЧЕГО (читает чужой QR) | Камера + золотая рамка сканирования |
| **6️⃣** | **Восстановление** | Выбор способа восстановления | НИЧЕГО (меню выбора) | 4 кнопки способов восстановления |
| **7️⃣** | **Успех** | Подтверждение регистрации | НИЧЕГО (итоговый экран) | Список семьи с буквами (А, Б, В...) |
| **8️⃣** | **Onboarding** | Приветствие | НИЧЕГО (начальный экран) | 3 кнопки: НАЧАТЬ/КОД/ВОССТАНОВИТЬ |

---

## 📷 ДЕТАЛЬНАЯ СХЕМА ОКНА #4 "СЕМЬЯ СОЗДАНА"

### ⚠️ ЗДЕСЬ ФОРМИРУЕТСЯ ВСЁ!

```
┌───────────────────────────────────────────────────────────────┐
│                     ШАГ 1: BACKEND                            │
└───────────────────────────────────────────────────────────────┘

API: POST /api/family/create
Request: { "role": "parent", "age_group": "24-55", "personal_letter": "А" }

Backend генерирует 5 ID:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. family_id: "FAM_A1B2C3D4E5F6"
   ↑ Внутренний ID семьи (16 символов)
   ↑ Используется в базе данных
   ↑ ПОЛЬЗОВАТЕЛЬ НЕ ВИДИТ! ❌

2. member_id: "MEM_X1Y2Z3W4"
   ↑ Внутренний ID пользователя (12 символов)
   ↑ Используется для API запросов
   ↑ ПОЛЬЗОВАТЕЛЬ НЕ ВИДИТ! ❌

3. recovery_code: "FAM-A1B2-C3D4-E5F6"
   ↑ Код для человека (с дефисами)
   ↑ Легко читать и вводить
   ↑ ПОЛЬЗОВАТЕЛЬ ВИДИТ! ✅

4. qr_code_data: '{"family_id":"FAM_A1B2C3D4E5F6","timestamp":1729512000,"type":"family_registration"}'
   ↑ JSON данные для кодирования в QR
   ↑ Содержит family_id + timestamp + type
   ↑ ПОЛЬЗОВАТЕЛЬ НЕ ВИДИТ (внутри QR-кода)! ❌

5. short_code: "AB12"
   ↑ Короткий код (4 символа)
   ↑ НЕ ИСПОЛЬЗУЕТСЯ в текущей версии
   ↑ ПОЛЬЗОВАТЕЛЬ НЕ ВИДИТ! ❌


┌───────────────────────────────────────────────────────────────┐
│                     ШАГ 2: iOS/ANDROID                        │
└───────────────────────────────────────────────────────────────┘

Приложение получает Response:
{
  "family_id": "FAM_A1B2C3D4E5F6",
  "recovery_code": "FAM-A1B2-C3D4-E5F6",
  "qr_code_data": "{...json...}",
  "member_id": "MEM_X1Y2Z3W4"
}

Генерирует 2 вещи для ПОКАЗА:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 1. QR-КОД КАРТИНКА:

   iOS: generateQRCode(from: qr_code_data)
   
   func generateQRCode(from string: String) -> UIImage? {
       let filter = CIFilter.qrCodeGenerator()
       filter.setValue(Data(string.utf8), forKey: "inputMessage")
       // ... масштабирование 10x ...
       return UIImage(cgImage: cgImage)
   }
   
   ВХОД: '{"family_id":"FAM_A1B2C3D4E5F6",...}'
   ВЫХОД: ┌─────────────────────┐
          │ ██  ██    ██  ██    │
          │   ██  ████  ██      │
          │ ██    ██  ██    ██  │
          └─────────────────────┘
          Размер: 180×180 пикселей


✅ 2. КОД ТЕКСТОМ:

   recovery_code = "FAM-A1B2-C3D4-E5F6"
   
   Просто показывается как есть:
   ┌─────────────────────┐
   │ FAM-A1B2-C3D4-E5F6  │  ← Моноширинный шрифт
   └─────────────────────┘


┌───────────────────────────────────────────────────────────────┐
│                     ШАГ 3: ПОКАЗ ПОЛЬЗОВАТЕЛЮ                 │
└───────────────────────────────────────────────────────────────┘

ОКНО #4:
┌───────────────────────────────────────────────┐
│  🎉 СЕМЬЯ СОЗДАНА!                            │
│                                               │
│  🔑 Ваш код восстановления:                   │
│                                               │
│  ┌──────────────────────────┐                 │
│  │                          │                 │
│  │    [QR-КОД КАРТИНКА]     │  ← ИЗ qr_code_data
│  │    180×180pt             │                 │
│  └──────────────────────────┘                 │
│                                               │
│  FAM-A1B2-C3D4-E5F6          ← ИЗ recovery_code
│                                               │
│  ⚠️ ВАЖНО: Сохраните этот код!                │
│                                               │
│  СПОСОБЫ СОХРАНЕНИЯ:                          │
│  [ ] 📋 Копировать                            │
│  [ ] 📸 Скриншот                              │
│  [ ] 💾 iCloud                                │
│  [ ] 📧 Email                                 │
│                                               │
│  [ПРОДОЛЖИТЬ] (выберите 1+ вариант)           │
└───────────────────────────────────────────────┘

ПОЛЬЗОВАТЕЛЬ ВИДИТ:
✅ QR-код (картинка) - может отсканировать
✅ Код (текст) - может скопировать/ввести

ПОЛЬЗОВАТЕЛЬ НЕ ВИДИТ:
❌ family_id: FAM_A1B2C3D4E5F6 (спрятан внутри QR!)
❌ member_id: MEM_X1Y2Z3W4 (вообще не показываем!)
❌ qr_code_data: {...} (JSON спрятан внутри QR!)
```

---

## 🆔 ГДЕ ВИДНО ID ПОЛЬЗОВАТЕЛЯ?

### ОТВЕТ: **НИГДЕ!** ❌

### ПОЧЕМУ?

**Member ID (MEM_X1Y2Z3W4)** - это **техническая информация** для backend!

Пользователю она **НЕ НУЖНА**, потому что:
- ✅ Это не имя (у нас есть буква А)
- ✅ Это не код восстановления (у нас есть FAM-A1B2-C3D4-E5F6)
- ✅ Это для API и базы данных

### ВМЕСТО MEMBER_ID ПОЛЬЗОВАТЕЛЬ ВИДИТ:

```
┌───────────────────────────────────────────────┐
│  👥 Ваша семья:                               │
│                                               │
│  👨‍👩‍👧‍👦 А - Родитель (24-55) ⭐ Вы!          │
│     ↑    ↑        ↑                           │
│  Иконка  "Имя"   Возраст                      │
│  роли    буква                                │
└───────────────────────────────────────────────┘
```

**Буква "А"** - это ваш идентификатор для людей!  
**Member_id** - это идентификатор для компьютера!

---

## 📊 ЧТО ПОКАЗЫВАЕТСЯ VS ЧТО СКРЫТО

### ✅ ПОЛЬЗОВАТЕЛЬ ВИДИТ:

| Что | Где | Пример |
|-----|-----|--------|
| **QR-код картинка** | Окно #4 | Чёрно-белый квадрат 180×180 |
| **Код восстановления** | Окно #4 | FAM-A1B2-C3D4-E5F6 |
| **Буква** | Окно #7, MainScreen, Settings | А |
| **Роль** | Окно #7, MainScreen | Родитель |
| **Возраст** | Окно #7 | 24-55 лет |
| **Бейдж "Вы"** | Окно #7 | ⭐ Вы! |

### ❌ ПОЛЬЗОВАТЕЛЬ НЕ ВИДИТ (СКРЫТО):

| Что | Зачем нужно | Где используется |
|-----|-------------|------------------|
| **family_id** | ID семьи в базе | API запросы, база данных |
| **member_id** | ID пользователя | API запросы, база данных |
| **qr_code_data** | JSON для QR | Внутри QR-кода |
| **short_code** | Короткий код | Не используется |
| **timestamp** | Время создания | Внутри QR-кода |

---

## 🔄 ПОЛНЫЙ FLOW С ДАННЫМИ

### FLOW: СОЗДАНИЕ СЕМЬИ (Новый пользователь)

```
┌──────────────────────────────────────────────────────────────┐
│  ЭТАП 1-3: СБОР ДАННЫХ (БЕЗ ГЕНЕРАЦИИ ID!)                   │
└──────────────────────────────────────────────────────────────┘

1️⃣ Роль:     Родитель     → selectedRole = "parent"
2️⃣ Возраст:  24-55        → selectedAgeGroup = "24-55"
3️⃣ Буква:    А            → selectedLetter = "А"

┌──────────────────────────────────────────────────────────────┐
│  ЭТАП 4: ГЕНЕРАЦИЯ ВСЕГО! (API CALL)                         │
└──────────────────────────────────────────────────────────────┘

Мобильное приложение отправляет:
POST /api/family/create
{
  "role": "parent",
  "age_group": "24-55",
  "personal_letter": "А",
  "device_type": "smartphone"
}

Backend генерирует:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
СКРЫТЫЕ ID (для техники):
  family_id: "FAM_A1B2C3D4E5F6"
  member_id: "MEM_X1Y2Z3W4"
  qr_code_data: '{"family_id":"FAM_A1B2C3D4E5F6",...}'

ПОКАЗЫВАЕМЫЕ КОДЫ (для человека):
  recovery_code: "FAM-A1B2-C3D4-E5F6"  ← ЭТО ВИДИТ ПОЛЬЗОВАТЕЛЬ!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

iOS/Android создаёт:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  QR-код картинка:  ┌─────────────┐
                    │ ██  ██  ██  │
                    │  ████  ██   │  ← ИЗ qr_code_data
                    │ ██  ██  ██  │
                    └─────────────┘

4️⃣ ОКНО "СЕМЬЯ СОЗДАНА":
┌───────────────────────────────────────────────┐
│  🎉 СЕМЬЯ СОЗДАНА!                            │
│                                               │
│  [QR-код картинка]  ← ФОРМИРУЕТСЯ ЗДЕСЬ!     │
│  FAM-A1B2-C3D4-E5F6 ← ФОРМИРУЕТСЯ ЗДЕСЬ!     │
│                                               │
│  4 чекбокса сохранения                        │
└───────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│  ЭТАП 5-7: ЗАВЕРШЕНИЕ (БЕЗ ГЕНЕРАЦИИ!)                        │
└──────────────────────────────────────────────────────────────┘

5️⃣ QR Scanner: Сканирует чужие QR-коды (ничего не генерирует)
6️⃣ Восстановление: Меню выбора (ничего не генерирует)
7️⃣ Успех: Показывает результат (ничего не генерирует)
```

---

## 💡 ПРОСТЫМИ СЛОВАМИ

### Вопрос 1: Это все этапы?
**Ответ:** ✅ **Да! 8 окон - это всё!**

### Вопрос 2: Формируется только картинка или и код?
**Ответ:** ✅ **ФОРМИРУЕТСЯ ОБА:**
- **QR-код картинка** (чёрно-белый квадрат 180×180)
- **Код текстом** (FAM-A1B2-C3D4-E5F6)

### Вопрос 3: Где видно ID пользователя?
**Ответ:** ❌ **НИГДЕ! Не показываем!**

Вместо `member_id: MEM_X1Y2Z3W4` пользователь видит:
- **Букву:** А
- **Роль:** Родитель
- **Возраст:** 24-55

Это **понятнее** и **достаточно**!

---

## 🎯 ИТОГОВАЯ СХЕМА

```
РЕГИСТРАЦИЯ (Новый пользователь):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1️⃣ Роль     → Сохраняет: "parent"
2️⃣ Возраст  → Сохраняет: "24-55"
3️⃣ Буква    → Сохраняет: "А"
              ↓
          API CALL ⚡
              ↓
4️⃣ Семья создана → ГЕНЕРИРУЕТ:
                    • QR-код картинку ✅
                    • Код FAM-A1B2-C3D4-E5F6 ✅
                    • member_id (СКРЫТ) ❌
              ↓
          Сохранение
              ↓
7️⃣ Успех    → Показывает: А - Родитель (24-55) ⭐ Вы!
              ↓
          MainScreen


ПРИСОЕДИНЕНИЕ (У меня есть код):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

8️⃣ Onboarding → [У МЕНЯ ЕСТЬ КОД]
              ↓
5️⃣ QR Scanner → СКАНИРУЕТ чужой QR #1
              ↓
1️⃣ Роль     → Сохраняет: "child"
2️⃣ Возраст  → Сохраняет: "7-12"
3️⃣ Буква    → Сохраняет: "Б"
              ↓
          API CALL ⚡
              ↓
7️⃣ Успех    → Показывает:
               А - Родитель (24-55)
               Б - Ребёнок (7-12) ⭐ Вы!
              ↓
          MainScreen


ВОССТАНОВЛЕНИЕ (4 способа):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

8️⃣ Onboarding → [ВОССТАНОВИТЬ]
              ↓
6️⃣ Восстановление → Выбор способа (4 кнопки)
              ↓
         ┌────┴────┬──────────┬──────────┐
         ↓         ↓          ↓          ↓
    Через семью  QR #2   Код вручную  Поддержка
         ↓         ↓          ↓          ↓
    5️⃣ Scanner  5️⃣ Scanner  Prompt    Email
              ↓
          API CALL ⚡
              ↓
7️⃣ Успех    → Показывает всю семью
              ↓
          MainScreen
```

---

## 🔑 КЛЮЧЕВОЙ ВЫВОД

### В ОКНЕ #4 ФОРМИРУЕТСЯ:

1. ✅ **QR-код картинка** (из JSON данных)
2. ✅ **Код текстом** (FAM-A1B2-C3D4-E5F6)

### ПОЛЬЗОВАТЕЛЬ НЕ ВИДИТ:

- ❌ `family_id` (внутренний ID семьи)
- ❌ `member_id` (внутренний ID пользователя)
- ❌ JSON данные (они внутри QR-кода)

### ИДЕНТИФИКАЦИЯ ПОЛЬЗОВАТЕЛЯ:

**Для компьютера:** `member_id: MEM_X1Y2Z3W4`  
**Для человека:** `А - Родитель (24-55)`

**Мы показываем то, что понятно! 🎯**




